A Stock Prediction System with GAN and DRL 
====
基于机器学习的股市预测系统
----

本系统参考了 https://github.com/borisbanushev/stockpredictionai 并尝试在A股市场中预测股价。

先写下实现的思路，以后慢慢改。

数据来源：https://tushare.pro/

For more information ： https://longfly04.github.io/A-Stock-Prediction-System-with-GAN-and-DRL/

# 1. 目录



# 2. 系统框架

<center><img src='doc\模型框架.jpg' width=1060></img></center>

1.系统需要获取股价信息，包括基本面、技术指标、财经新闻、上市公司财报和金融银行拆借利率等信息。训练模型使用90%训练集，9%交叉验证，1%测试。应用模型使用95%训练，5%验证，生成5%预测数据。


2.个股基本面、技术指标特征进行归一化。消息面特征经过BERT，取300维特征，归一化。


3.向量拼接后分为两流：

stream1 输入VAE，输出结果经PCA，降到80%，再进入到XGBoost，90%训练，9%验证，1%测试。

stream2 直接进到boost的数据，90%训练，9%验证，1%测试。

两个stream的output进入可视化，相当于对比特征工程对数据压缩后，数据意义表达层面有没有问题。

（但是为什么要这么做还是没搞懂。。。）

两个训练结果进本地保存，并附加时间戳。

4.stream1的输出进入GAN模型，Generator是LSTM，400维，Discriminator是CNN，padding是1维的么？主模型每50次迭代输入1次日志，每500次迭代为一次训练。

训练结果进可视化。

训练完成的模型参数进本地保存，并附加时间戳。


5.计算的D-loss和G-loss需要保存，predic-real-loss也需要保存，作为RL的输入。


6.将GAN的超参数集封装为一个对象HyperParameters，交给RL进行调优。


7.第五步的loss之和作为奖励，输入到Q值中，用PPO这种直接采取行动的方式调整HyperParameters。


每50次迭代记录一次日志，并同时将RL的参数保存到本地。

（不知道会调成什么样子。。。）


8.最后，让它跑起来。



# 3. 数据获取

通过tushare获取上证50成分股中部分股票每日成交信息和财务信息，包括：日线行情、资金流向、利润、资产负债情况、现金流量、财务报表等信息。数据的时间跨度为十年，从2008年1月1日至2018年12月31日。同时，获取了这个时间跨度内的宏观经济数据，包括利率、银行间同业拆借利率，民间借贷利率；市场交易数据，包括：沪深港通资金流向、北向资金流入、大宗交易、股票质押回购等信息。数据维度共576维。

StockData类：

1.getStockList():获取股票基本信息：股票列表、上市公司基本信息

2.getStockMarket():获取股票行情：代码、交易日、开盘价、收盘价、最高价、最低价、昨收价、涨跌幅、成交量、成交额

3.getDailyIndicator():获取每日指标：股票代码、交易日期、收盘价、换手率、量比、市盈率、市净率、市销率、总股本、流通股本、市值、流通市值。

4.getStockCurrent():个股资金流向:股票代码、交易日期、小单买入量（手）、小单买入金额（万元）、小单卖出量（手）、小单卖出金额（万元）、中单买入量（手）、中单买入金额（万元）、中单卖出量（手）、中单卖出金额（万元）、大单买入量（手）、大单买入金额（万元）、大单卖出量（手）、大单卖出金额（万元）、特大单买入量（手）、特大单买入金额（万元）、特大单卖出量（手）、特大单卖出金额（万元）、净流入量（手）、净流入额（万元）

StockFinance类：获取财务数据 API参考tushare

1.getProfit():获取上市公司财务利润

2.getBalanceSheet():获取上市公司资产负债表

3.getCashflow():获取上市公司现金流量表

4.getForecast():获取业绩预告数据

5.getExpress():获取上市公司业绩快报

6.getDividend():获取分红送股

7.getFinacialIndicator():获取上市公司财务指标数据 

8.getFinacialAudit():获取上市公司定期财务审计意见数据 

9.getFinacialMain():获得上市公司主营业务构成，分地区和产品两种方式

Market类:获取市场参考数据

1.getMoneyflow_HSGT():获取沪股通、深股通、港股通每日资金流向数据，每次最多返回300条记录，总量不限制 

2.getSecuritiesMarginTrading():获取融资融券每日交易汇总数据 

3.getPledgeState():获取股权质押统计数据 

4.getRepurchase():获取上市公司回购股票数据

5.getDesterilization():获取限售股解禁 

6.getBlockTrade():获取大宗交易 

7.getStockHolder():获取上市公司增减持数据，了解重要股东近期及历史上的股份增减变化 

Index类:指数

1.getIndexBasic():获取指数基础信息。

2.getIndexDaily():获取指数每日行情，还可以通过bar接口获取。  

3.getIndexWeight():获取各类指数成分和权重，月度数据  

4.getStockMarketIndex():上证综指指标数据

Futures类：期货

1.getFuturesDaily():获取期货日线

2.getFururesHolding():获取每日成交量

3.getFuturesWSR():获取仓单日报


Interest类：利率

1.getShibor():上海银行间同业拆放利率（Shanghai Interbank Offered Rate，简称Shibor），以位于上海的全国银行间同业拆借中心为技术平台计算、发布并命名，是由信用等级较高的银行组成报价团自主报出的人民币同业拆出利率计算确定的算术平均利率，是单利、无担保、批发性利率。

2.getShiborQuote():Shibor报价数据 

3.getShibor_LPR():贷款基础利率（Loan Prime Rate，简称LPR），是基于报价行自主报出的最优贷款利率计算并发布的贷款市场参考利率。目前，对社会公布1年期贷款基础利率。 

4.getLibor():Libor（London Interbank Offered Rate ），即伦敦同业拆借利率，是指伦敦的第一流银行之间短期资金借贷的利率，是国际金融市场中大多数浮动利率的基础利率。 

5.getHibor():HIBOR (Hongkong InterBank Offered Rate)，是香港银行同行业拆借利率。指香港货币市场上，银行与银行之间的一年期以下的短期资金借贷利率，从伦敦同业拆借利率（LIBOR）变化出来的。 

6.getWenZhouIndex():温州指数 ，即温州民间融资综合利率指数，该指数及时反映民间金融交易活跃度和交易价格。该指数样板数据主要采集于四个方面：由温州市设立的几百家企业测报点，把各自借入的民间资本利率通过各地方金融办不记名申报收集起来；对各小额贷款公司借出的利率进行加权平均；融资性担保公司如典当行在融资过程中的利率，由温州经信委和商务局负责测报；民间借贷服务中心的实时利率。(可选，2012年开放数据)

7.getGuangZhouIndex():广州民间借贷利率(可选)

News类：获取经济和金融新闻

get_news.py：获取新闻，获取主流新闻网站的快讯新闻数据 

1.getNews():新闻资讯数据从2018年10月7日开始有数据 之前没有数据

2.getCompanyPublic():上市公司公告 几乎都是空的

3.getCCTVNews():CCTV 接口限制每分钟100次



# 4. 数据特征工程

## 4.1. 概述

特征工程的好坏决定了模型的上限，调参只是逼近这个上限而已。

这个阶段，我计划将收集的数据以每日股价收盘价作为标签，获取技术指标，并作为数据特征。传统技术指标分析主要是针对股价，包括了7日均线，21日均线，MACD平滑异同移动均线，BOLLING布林线等，实际上，股价的波动在影响因素上，取决于非常多的客观交易行为，传统技术指标只是对股价的时间统计特征进行体现，并没有将市场的细节展现出来。本系统我将尝试增加自定义的技术指标，试图追踪交易量、大单买入卖出、换手率等指标的统计特征，并对以上技术指标进行频率分析，以期待获得更多市场行为信息。

基本面分析主要参考上市公司财务数据和公告，但是由于公告涉及到文本分析且数据量较少，这部分仅保留财务数据。另外，宏观经济数据也作为基本面分析的一部分。

特征组合，删除重复特征以及空值处理。由于特征存在大量空值，所以要分情况对空值进行处理，主要的方式是以空值前一日的value填充。即便如此，股价数据集仍然是一个庞大的稀疏矩阵。

在股价趋势预测任务中，暂时不适用于将每日财经新闻进行情感分析并作为事件特征，因为每日新闻数据量较大，对于个股的影响需要提取相关系数矩阵，计算量惊人。考虑到新闻的综合影响会直接体现在交易数据中，所以在技术指标中增加交易数据的统计特征，平衡特征的数量。



## 4.2. 基本面分析

概括起来，基本分析主要包括以下三个方面内容：

（1）宏观经济分析。研究经济政策（货币政策、财政政策、税收政策、产业政策等等）、经济指标（国内生产总值、失业率、通胀率、利率、汇率等等）对股票市场的影响。

（2）行业分析。分析产业前景、区域经济发展对上市公司的影响。

（3）公司分析。具体分析上市公司行业地位、市场前景、财务状况。

这里，基本面分析参考的指标主要包括：


|外汇|期权合约信息|期货|市场参考数据|宏观经济
|---|----|-----|---------|---|
|外汇基础信息（海外）|期权合约信息|期货合约信息|沪深港通资金流向|利率数据
|外汇日线行情|期权日线行情|期货合约信息 |沪深股通十大成交股|shibor利率
||期货交易日历 |港股通十大成交股||shibor报价数据
||期货日线行情 |融资融券交易汇总||LPR贷款基础利率
||每日持仓排名 |融资融券交易明细||Libor利率
||仓单日报 |前十大股东||Hibor利率
||每日结算参数 |前十大流通股东||温州民间借贷利率
||南华期货指数行情 |龙虎榜每日明细||广州民间借贷利率
||期权|龙虎榜机构交易明细
|||股权质押统计数据
|||股权质押明细数据
|||股票回购
|||概念股分类表
|||概念股明细列表
|||限售股解禁
|||大宗交易
|||股票开户数据
|||股票开户数据（旧）
|||股东人数
|||股东增减持


## 4.3. 技术指标分析

技术指标分析是主要的分析手段，技术指标主要包括：

| 指标 | 格式 | 含义 |
| --- | --- | --- |
| open | float | 开盘价 |
|high|float|最高价
|low|float|最低价
|close|float|收盘价
|pre_close|float|昨收价
|change|float|涨跌额
|pct_chg|float|涨跌幅 （未复权，如果是复权请用 通用行情接口 ）
|vol|float|成交量 （手）
|amount|float|成交额 （千元）
|close|float|当日收盘价
|turnover_rate|float|换手率（%）
|turnover_rate_f|float|换手率（自由流通股）
|volume_ratio|float|量比
|pe|float|市盈率（总市值/净利润）
|pe_ttm|float|市盈率（TTM）
|pb|float|市净率（总市值/净资产）
|ps|float|市销率
|ps_ttm|float|市销率（TTM）
|total_share|float|总股本 （万股）
|float_share|float|流通股本 （万股）
|free_share|float|自由流通股本 （万）
|total_mv|float|总市值 （万元）
|circ_mv|float|流通市值（万元）
|buy_sm_vol|int|小单买入量（手）
|buy_sm_amount|float|小单买入金额（万元）
|sell_sm_vol|int|小单卖出量（手）
|sell_sm_amount|float|小单卖出金额（万元）
|buy_md_vol|int|中单买入量（手）
|buy_md_amount|float|中单买入金额（万元）
|sell_md_vol|int|中单卖出量（手）
|sell_md_amount|float|中单卖出金额（万元）
|buy_lg_vol|int|大单买入量（手）
|buy_lg_amount|float|大单买入金额（万元）
|sell_lg_vol|int|大单卖出量（手）
|sell_lg_amount|float|大单卖出金额（万元）
|buy_elg_vol|int|特大单买入量（手）
|buy_elg_amount|float|特大单买入金额（万元）
|sell_elg_vol|int|特大单卖出量（手）
|sell_elg_amount|float|特大单卖出金额（万元）
|net_mf_vol|int|净流入量（手）
|net_mf_amount|float|净流入额（万元）


### 平滑异同平均线指标——MACD

MACD指标又叫指数平滑异同移动平均线，是由查拉尔·阿佩尔（Gerald Apple）所创造的,是一种研判股票买卖时机、跟踪股价运行趋势的技术分析工具。

#### MACD指标的原理

MACD指标是根据均线的构造原理，对股票价格的收盘价进行平滑处理，求出算术平均值以后再进行计算，是一种趋向类指标。

MACD 指标是运用快速（短期）和慢速（长期）移动平均线及其聚合与分离的征兆，加以双重平滑运算。而根据移动平均线原理发展出来的MACD，一则去除了移动平均线频繁发出假信号的缺陷，二则保留了移动平均线的效果，因此，MACD指标具有均线趋势性、稳重性、安定性等特点，是用来研判买卖股票的时机，预测股票价格涨跌的技术分析指标。

MACD 指标主要是通过EMA、DIF和DEA（或叫MACD、DEM）这三值之间关系的研判，DIF和DEA连接起来的移动平均线的研判以及DIF减去DEM值而绘制成的柱状图（BAR）的研判等来分析判断行情，预测股价中短期趋势的主要的股市技术分析指标。其中，DIF是核心，DEA是辅助。DIF是快速平滑移动平均线（EMA1）和慢速平滑移动平均线（EMA2）的差。BAR柱状图在股市技术软件上是用红柱和绿柱的收缩来研判行情。

#### MACD指标的计算方法

MACD在应用上，首先计算出快速移动平均线（即EMA1）和慢速移动平均线（即EMA2），以此两个数值，来作为测量两者（快慢速线）间的离差值（DIF）的依据，然后再求DIF的N周期的平滑移动平均线DEA（也叫MACD、DEM）线。

以EMA1的参数为12日，EMA2的参数为26日，DIF的参数为9日为例来看看MACD的计算过程

1、计算移动平均值（EMA）

12日EMA的算式为

EMA（12）=前一日EMA（12）×11/13＋今日收盘价×2/13

26日EMA的算式为

EMA（26）=前一日EMA（26）×25/27＋今日收盘价×2/27

2、计算离差值（DIF）

DIF=今日EMA（12）－今日EMA（26）

3、计算DIF的9日EMA

根据离差值计算其9日的EMA，即离差平均值，是所求的MACD值。为了不与指标原名相混淆，此值又名DEA或DEM。

今日DEA（MACD）=前一日DEA×8/10＋今日DIF×2/10

计算出的DIF和DEA的数值均为正值或负值。

理论上，在持续的涨势中，12 日EMA线在26日 EMA线之上，其间的正离差值（+DIF）会越来越大；反之，在跌势中离差值可能变为负数（—DIF），也会越来越大，而在行情开始好转时，正负离差值将会缩小。指标MACD正是利用正负的离差值（±DIF）与离差值的N日平均线（N日EMA）的交叉信号作为买卖信号的依据，即再度以快慢速移动线的交叉原理来分析买卖信号。另外，MACD指标在股市软件上还有个辅助指标——BAR柱状线，其公式为：BAR=2×(DIF－DEA)，我们还是可以利用BAR 柱状线的收缩来决定买卖时机。

离差值DIF 和离差平均值DEA是研判MACD的主要工具。其计算方法比较烦琐，由于目前这些计算值都会在股市分析软件上由计算机自动完成，因此，投资者只要了解其运算过程即可，而更重要的是掌握它的研判功能。另外，和其他指标的计算一样，由于选用的计算周期的不同，MACD指标也包括日MACD指标、周MACD指标、月MACD指标年MACD指标以及分钟MACD指标等各种类型。经常被用于股市研判的是日MACD指标和周MACD指标。虽然它们的计算时的取值有所不同，但基本的计算方法一样。

在实践中，将各点的 DIF和DEA（MACD）连接起来就会形成在零轴上下移动的两条快速（短期）和慢速（长期）线，此即为MACD图。

#### MACD指标的一般研判标准

MACD 指标是市场上绝大多数投资者熟知的分析工具，但在具体运用时，投资者可能会觉得MACD指标的运用的准确性、实效性、可操作性上有很多茫然的地方，有时会发现用从书上学来的MACD指标的分析方法和技巧去研判股票走势，所得出的结论往往和实际走势存在着特别大的差异，甚至会得出相反的结果。这其中的主要原因是市场上绝大多数论述股市技术分析的书中关于MACD的论述只局限在表面的层次，只介绍MACD的一般分析原理和方法，而对MACD分析指标的一些特定的内涵和分析技巧的介绍鲜有涉及。

### 随机指标——KDJ

   KDJ指标又叫随机指标，是由乔治·蓝恩博士（George Lane）最早提出的，是一种相当新颖、实用的技术分析指标，它起先用于期货市场的分析，后被广泛用于股市的中短期趋势分析，是期货和股票市场上最常用的技术分析工具。


#### KDJ指标的原理

随机指标KDJ 一般是根据统计学的原理，通过一个特定的周期（常为9日、9周等）内出现过的最高价、最低价及最后一个计算周期的收盘价及这三者之间的比例关系，来计算最后一个计算周期的未成熟随机值RSV，然后根据平滑移动平均线的方法来计算K值、D值与J值，并绘成曲线图来研判股票走势。

随机指标KDJ 是以最高价、最低价及收盘价为基本数据进行计算，得出的K值、D值和J值分别在指标的坐标上形成的一个点，连接无数个这样的点位，就形成一个完整的、能反映价格波动趋势的KDJ指标。它主要是利用价格波动的真实波幅来反映价格走势的强弱和超买超卖现象，在价格尚未上升或下降之前发出买卖信号的一种技术工具。它在设计过程中主要是研究最高价、最低价和收盘价之间的关系，同时也融合了动量观念、强弱指标和移动平均线的一些优点，因此，能够比较迅速、快捷、直观地研判行情。

随机指标KDJ 最早是以KD指标的形式出现，而KD指标是在威廉指标的基础上发展起来的。不过威廉指标只判断股票的超买超卖的现象，在KDJ指标中则融合了移动平均线速度上的观念，形成比较准确的买卖信号依据。在实践中，K线与D线配合J线组成KDJ指标来使用。由于KDJ线本质上是一个随机波动的观念，故其对于掌握中短期行情走势比较准确。

 

#### KDJ指标的计算方法

指标KDJ的计算比较复杂，首先要计算周期（n日、n周等）的RSV值，即未成熟随机指标值，然后再计算K值、D值、J值等。以日KDJ数值的计算为例，其计算公式为

n日RSV=（Cn－Ln）÷（Hn－Ln）×100

式中，Cn为第n日收盘价；Ln为n日内的最低价；Hn为n日内的最高价。RSV值始终在1—100间波动。

其次，计算K值与D值：

当日K值=2/3×前一日K值＋1/3×当日RSV

当日D值=2/3×前一日D值＋1/3×当日K值

若无前一日K 值与D值，则可分别用50来代替。

以9日为周期的KD线为例。首先须计算出最近9日的RSV值，即未成熟随机值，计算公式为

9日RSV=（C－L9）÷（H9－L9）×100

式中，C为第9日的收盘价；L9为9日内的最低价；H9为9日内的最高价。

K值=2/3×前一日 K值＋1/3×当日RSV

D值=2/3×前一日K值＋1/3×当日RSV

若无前一日K值与D值，则可以分别用50代替。

需要说明的是，式中的平滑因子1/3和2/3是可以人为选定的,不过目前已经约定俗成，固定为1/3和2/3。在大多数股市分析软件中，平滑因子已经被设定为1/3和2/3，不需要作改动。另外，一般在介绍KD时，往往还附带一个J指标。

J指标的计算公式为：

J=3D—2K

实际上，J的实质是反映K值和D值的乖离程度，从而领先KD值找出头部或底部。J值范围可超过100。

J 指标是个辅助指标，最早的KDJ指标只有两条线，即K线和D线，指标也被称为KD指标，随着股市分析技术的发展，KD指标逐渐演变成KDJ指标，从而提高了KDJ指标分析行情的能力。另外，在一些股市重要的分析软件上，KDJ指标的K、D、J参数已经被简化成仅仅一个，即周期数（如日、周、月等），而且，随着股市软件分析技术的发展，投资者只需掌握KDJ形成的基本原理和计算方法，无须去计算K、D、J的值，更为重要的是利用KDJ指标去分析、研判股票行情。

和其他指标的计算一样，由于选用的计算周期的不同，KDJ指标也包括日KDJ指标、周KDJ指标、月KDJ指标年KDJ指标以及分钟KDJ指标等各种类型。经常被用于股市研判的是日KDJ指标和周KDJ指标。虽然它们的计算时的取值有所不同，但基本的计算方法一样。

 
#### KDJ指标的一般研判标准

随机指标KDJ 主要是通过K、D和J这三条曲线的所构成的图形关系来分析股市上的超买超卖，走势背离及K线、D线和J线相互交叉突破等现象，从而预测股价中、短期及长期趋势。KDJ是市场上绝大多数投资者熟知的分析工具，但具体运用时，投资者可能会发现KDJ的分析结果和实际走势存在着特别大的差别，有时还会得出相反的结论，这其中原因主要是绝大多数投资者只知道KDJ的一般分析原理和方法，而对KDJ分析指标的一些内涵和特定的分析技巧知之甚少。本节在介绍股市分析中市场上流行的KDJ的一般研判技巧和分析方法上，重点挖掘KDJ指标的内在规律，详细分析KDJ的一些特殊研判功能。

KDJ指标是三条曲线，在应用时KDJ指标的一般研判标准主要是从KDJ三个参数的取值、KDJ曲线的形态、KDJ曲线的交叉、KDJ曲线的背离和K线、D线、J线的运行状态以及KDJ曲线同股价曲线的配合等六个方面来考虑。

一、KDJ的取值

1、取值范围

KDJ指标中，K值和D值的取值范围都是0—100，而J值的取值范围可以超过100和低于0，但在分析软件上KDJ的研判范围都是0—100。通常就敏感性而言，J值最强，K值次之，D值最慢，而就安全性而言，J值最差，K值次之，D值最稳。

2、超买超卖信号
根据KDJ的取值，可将其划分为几个区域，即超买区、超卖区和徘徊区。按一般划分标准，K、D、J这三值在20以下为超卖区，是买入信号；K、D、J这三值在80以上为超买区，是卖出信号；K、D、J这三值在20—80之间为徘徊区，宜观望。

3、 多空力量对比

一般而言，当K、D、J三值在50附近时，表示多空双方力量均衡；当K、D、J三值都大于50时，表示多方力量占优；当K、D、J三值都小于50时，表示空方力量占优。

二、KDJ曲线的形态

KDJ 指标的研判还可以从KDJ曲线的形态来分析。当KDJ指标曲线图形形成头肩顶底形态、双重顶底形态（即M头、W底）及三重顶底等形态时，也可以按照形态理论的研判方法加以分析。KDJ曲线出现的各种形态是判断行情走势、决定买卖时机的一种分析方法。另外，KDJ指标曲线还可以划趋势线、压力线和支撑线等。

1、当KDJ曲线在50上方的高位时，如果KDJ曲线的走势形成M头或三重顶等顶部反转形态，可能预示着股价由强势转为弱势，股价即将大跌，应及时卖出股票。如果股价的曲线也出现同样形态则更可确认，其跌幅可以用M头或三重顶等形态理论来研判。

2、当KDJ曲线在50下方的低位时，如果KDJ曲线的走势出现W底或三重底等底部反转形态，可能预示着股价由弱势转为强势，股价即将反弹向上，可以逢低少量吸纳股票。如果股价曲线也出现同样形态更可确认，其涨幅可以用W底或三重底形态理论来研判。

3、KDJ曲线的形态中M头和三重顶形态的准确性要大于W底和三重底。

三、KDJ曲线的交叉

KDJ曲线的交叉分为黄金交叉和死亡交叉两种形式

一般而言，在一个股票的完整的升势和跌势过程中，KDJ指标中的K、D、J线会出现两次或以上的“黄金交叉”和“死亡交叉”情况。

1、当股价经过一段很长时间的低位盘整行情，并且K、D、J三线都处于50线以下时，一旦J线和K线几乎同时向上突破D线时，表明股市即将转强，股价跌势已经结束，将止跌朝上，可以开始买进股票，进行中长线建仓。这是KDJ指标“黄金交叉”的一种形式。

2、当股价经过一段时间的上升过程中的盘整行情，并且K、D、J线都处于50线附近徘徊时，一旦J线和K线几乎同时再次向上突破D线，成交量再度放出时，表明股市处于一种强势之中，股价将再次上涨，可以加码买进股票或持股待涨，这就是KDJ指标“黄金交叉”的一种形式。

3、当股价经过前期一段很长时间的上升行情后，股价涨幅已经很大的情况下，一旦J线和K线在高位（80以上）几乎同时向下突破D线时，表明股市即将由强势转为弱势，股价将大跌，这时应卖出大部分股票而不能买股票，这就是KDJ指标的“死亡交叉”的一种形式。

4、当股价经过一段时间的下跌后，而股价向上反弹的动力缺乏，各种均线对股价形成较强的压力时，KDJ曲线在经过短暂的反弹到80线附近，但未能重返80线以上时，一旦J线和K线再次向下突破D线时，表明股市将再次进入极度弱市中，股价还将下跌，可以再卖出股票或观望，这是KDJ指标“死亡交叉”的另一种形式。

四、KDJ曲线的背离

KDJ曲线的背离就是指当KDJ指标的曲线图的走势方向正好和K线图的走势方向正好相反。KDJ指标的背离有顶背离和底背离两种。

当股价K线图上的股票走势一峰比一峰高，股价在一直向上涨，而KDJ曲线图上的KDJ指标的走势是在高位一峰比一峰低，这叫顶背离现象。顶背离现象一般是股价将高位反转的信号，表明股价中短期内即将下跌，是卖出的信号。

当股价K线图上的股票走势一峰比一峰低，股价在向下跌，而KDJ曲线图上的KDJ指标的走势是在低位一底比一底高，这叫低背离现象。底背离现象一般是股价将低位反转的信号，表明股价中短期内即将上涨，是买入的信号。

与其他技术指标的背离现象研判一样，KDJ 的背离中，顶背离的研判准确性要高于底背离。当股价在高位，KDJ在80以上出现顶背离时，可以认为股价即将反转向下，投资者可以及时卖出股票；而股价在低位，KDJ也在低位（50以下）出现底背离时，一般要反复出现几次底背离才能确认，并且投资者只能做战略建仓或做短期投资。

五、K、D、J曲线运行的状态

1、当J曲线开始在底部（50以下）向上突破K曲线时，说明股价的弱势整理格局可能被打破，股价短期将向上运动，投资者可以考虑少量长线建仓。

2、当J曲线向上突破K曲线并迅速向上运动，同时曲线也向上突破D曲线，说明股价的中长期上涨行情已经开始，投资者可以加大买入股票的力度。

3、当K、D、J曲线开始摆脱前期窄幅盘整的区间并同时向上快速运动时，说明股价已经进入短线强势拉升行情，投资者应坚决持股待涨。

4、当J曲线经过一段快速向上运动的过程后开始在高位（80以上）向下掉头时，说明股价短期上涨过快，将开始短线调整，投资者可以短线卖出股票。

5、当D曲线也开始在高位向下掉头时，说明股价的短期上涨行情可能结束，投资者应中线卖出股票。

6、当K曲线也开始在高位向下掉头时，说明股价的中短期上涨行情已经结束，投资者应全部清仓离场。

7、当K、D、J曲线从高位同时向下运动时，说明股价的下跌趋势已经形成，投资者应坚决持币观望。

六、KDJ曲线与股价曲线的配合使用

1、当KDJ曲线与股价曲线从低位（KDJ值均在50以下）同步上升，表明股价中长期趋势向好、短期内股价有望继续上涨趋势，投资者应继续持股或逢低买入。

2、当KDJ曲线与股价曲线从高位（KDJ值均在50以上）同步下降，表明短期内股价将继续下跌趋势，投资者应继续持币观望或逢高卖出。

3、当KDJ曲线从高位回落，经过一段时间强势盘整后再度向上并创出新高，而股价曲线也在高位强势盘整后再度上升创出新高，表明股价的上涨动力依然较强，投资者可继续持股待涨。

4、当KDJ曲线从高位回落，经过一段时间盘整后再度向上，但到了前期高点附近时却掉头向下、未能创出新高时，而股价曲线还在缓慢上升并创出新高，KDJ曲线和股价曲线在高位形成了相反的走势，这可能就意味着股价上涨的动力开始减弱，KDJ指标出现了顶背离现象。此时投资者应千万小心，一旦股价从下，应果断及时地离场。

5、当KDJ曲线在长期弱势下跌过程中，经过一段时间弱势反弹后再度向下并创出新低，而股价曲线也在弱势盘整后再度向下创出新低，表明股价的下跌动能依然较强，投资者可继续持币观望。

6、当KDJ曲线从低位向上反弹到一定高位、再度向下回落，但回调到前期低点附近时止跌企稳、未能创出新低时，而股价曲线还在缓慢下降并创出新低，KDJ曲线和股价曲线在低位形成相反的走势，这可能就意味着股价下跌的动能开始衰弱，KDJ指标出现了底背离现象。此时投资者也应密切关注股价动向，一旦股价向上就可以短线买入，等待反弹的出现。


### 威廉指标——W%R

威廉指标W%R又叫威廉超买超卖指标，简称威廉指标，是由拉瑞·威廉（Larry William）在1973年发明的，是目前股市技术分析中比较常用的短期研判指标。



#### 威廉指标的原理

威廉指标主要是通过分析一段时间内股价最高价、最低价和收盘价之间的关系，来判断股市的超买超卖现象，预测股价中短期的走势。它主要是利用振荡点来反映市场的超买超卖行为，分析多空双方力量的对比，从而提出有效的信号来研判市场中短期行为的走势。

威廉指标是属于研究股价波幅的技术分析指标，在公式设计上和随机指标的原理比较相似，两者都是从研究股价波幅出发，通过分析一段时间的股票的最高价、最低价和收盘价等这三者关系，来反映市场的买卖气势的强弱，借以考察阶段性市场气氛、判断价格和理性投资价值标准相背离的程度。

和股市其他技术分析指标一样，威廉指标可以运用于行情的各个周期的研判，大体而言，威廉指标可分为日、周、月、年、5 分钟、15分钟、30分钟、60分钟等各种周期。虽然各周期的威廉指标的研判有所区别，但基本原理相差不多。如日威廉指标是表示当天的收盘价在过去的一段日子里的全部价格范围内所处的相对位置，把这些日子里的最高价减去当日收市价，再将其差价除以这段日子的全部价格范围就得出当日的威廉指标。

威廉指标在计算时首先要决定计算参数，此数可以采取一个买卖循环周期的半数。以日为买卖的周期为例，通常所选用的买卖循环周期为8日、14日、28日或56日等，扣除周六和周日，实际交易日为6日、10日、20日或40日等，取其一半则为3日、5日、10日或20日等。

#### W%R指标的计算方法

W%R指标的计算主要是利用分析周期内的最高价、最低价及周期结束的收盘价等三者之间的关系展开的。以日威廉指标为例，其计算公式为：

W%R=（Hn—C）÷（Hn—Ln）×100

其中：C为计算日的收盘价，Ln为N周期内的最低价，Hn为N周期内的最高价，公式中的N为选定的计算时间参数，一般为4或14。

以计算周期为14日为例，其计算过程如下：

W%R（14日）=（H14—C）÷（H14—L14）×100

其中，C为第14天的收盘价，H14为14日内的最高价，L14为14日内的最低价。

威廉指标是表示当天的收盘价在过去一段时间里的全部价格范围内所处的相对位置，因此，计算出的W%R值位于0——100之间。越接近0值，表明目前的价位越接近过去14日内的最低价；越接近100值，表明目前的价位越接近过去14日内的最高价，从这点出发，对于威廉指标的研判可能比较更容易理解。

由于计算方法的不同，威廉指标的刻度在有些书中与随机指标W%R 和相对强弱指标RSI一样，顺序是一样的，即上界为100、下界为0。而在我国沪深股市通用的股市分析软件（钱龙、分析家等分析软件系统）中，W%R的刻度与RSI的刻度相反。为方便投资者，这里介绍的W%R的刻度与钱龙（分析家）软件相一致，即上界为0、下界为100。

另外，和其他指标的计算一样，由于选用的计算周期的不同，W%R指标也包括日W%R指标、周W%R指标、月W%R指标和年W%R指标以及分钟W%R指标等各种类型。经常被用于股市研判的是日W%R指标和周W%R指标。虽然它们的计算时的取值有所不同，但基本的计算方法一样。

####  W%R指标的一般研判标准

W%R指标的一般研判标准主要是围绕W%R的数值大小、W%R曲线形状等方面展开的。

一、W%R数值的大小

和KDJ指标一样，W%R的数值范围为0——100。不同的是W%R指标是以0为顶部，以100为底部。

1、当W%R在20——0区间时，是W%R指标的超买区，表明市场处于超买状态，股票价格已进入顶部，可考虑卖出。W%R=20这一横线，一般视为卖出线。

2、当W%R进入80——100区间时，是W%R指标的超卖区，表明市场处于超卖状态，股票价格已近底部，可考虑买入。W%R=80这一横线，一般视为买入线。

3、当W%R在20——80区间时，表明市场上多空暂时取得平衡，股票价格处于横盘整理之中，可考虑持股或持币观望。

4、在具体实战中，当威廉曲线向上突破20超买线而进入超买区运行时，表明股价进入强势拉升行情，这是提醒投资者要密切关注行情的未来走势，只有当W%R曲线再次向下突破20线时，才为投资者提出预警，为投资者买卖决策提供参考。同样，当威廉曲线向下突破80超卖线而进入超卖区运行时，表明股价的强势下跌已经缓和，这也是提醒投资者可以为建仓作准备，而只有当W%R曲线再次向上突破80线时，投资者才真正短线买入。

二、W%R曲线的形状

1、当W%R曲线从超卖区开始向上爬升，超过80这条买入线时，说明行情可能向上突破，是开始买入的信号。

2、当W%R曲线从超买区开始向下回落，跌破20这条卖出线时，说明行情可能向下反转，是开始卖出的信号。

3、当W%R曲线由超卖区向上突破50这条多空平衡线时，说明股价涨势较强，可考虑短线加码买入。

4、当W%R曲线由超买区向下突破50这条多空平衡线时，说明股价跌势较强，可考虑短线加码卖出。


### 相对强弱指标——RSI

相对强弱指标RSI又叫力度指标，其英文全称为“Relative Strength Index”，由威尔斯·魏尔德﹝Welles Wilder﹞所创造的，是目前股市技术分析中比较常用的中短线指标。


#### RSI指标的原理

相对强弱指标RSI是根据股票市场上供求关系平衡的原理，通过比较一段时期内单个股票价格的涨跌的幅度或整个市场的指数的涨跌的大小来分析判断市场上多空双方买卖力量的强弱程度，从而判断未来市场走势的一种技术指标。

从它构造的原理来看，与MACD、 TRIX等趋向类指标相同的是，RSI指标是对单个股票或整个市场指数的基本变化趋势作出分析，而与MACD、TRIX等不同的是，RSI指标是先求出单个股票若干时刻的收盘价或整个指数若干时刻收盘指数的强弱，而不是直接对股票的收盘价或股票市场指数进行平滑处理。

相对强弱指标RSI是一定时期内市场的涨幅与涨幅加上跌幅的比值。它是买卖力量在数量上和图形上的体现，投资者可根据其所反映的行情变动情况及轨迹来预测未来股价走势。在实践中，人们通常将其与移动平均线相配合使用，借以提高行情预测的准确性。

#### RSI指标的计算方法

相对强弱指标RSI的计算公式有两种

其一：

假设A为N日内收盘价的正数之和，B为N日内收盘价的负数之和乘以（—1）

这样，A和B均为正，将A、B代入RSI计算公式，则

RSI（N）=A÷（A＋B）×100

其二：

RS（相对强度）=N日内收盘价涨数和之均值÷N日内收盘价跌数和之均值

RSI（相对强弱指标）=100－100÷（1+RS）

这两个公式虽然有些不同，但计算的结果一样。

以14日RSI指标为例，从当起算，倒推包括当日在内的15个收盘价，以每一日的收盘价减去上一日的收盘价，得到14个数值，这些数值有正有负。这样，RSI指标的计算公式具体如下：

A=14个数字中正数之和

B=14个数字中负数之和乘以（—1）

RSI（14）=A÷（A＋B）×100

式中：A为14日中股价向上波动的大小

B为14日中股价向下波动的大小

A＋B为股价总的波动大小

RSI 的计算公式实际上就是反映了某一阶段价格上涨所产生的波动占总的波动的百分比率，百分比越大，强势越明显；百分比越小，弱势越明显。RSI的取值介于0— 100之间。在计算出某一日的RSI值以后，可采用平滑运算法计算以后的RSI值，根据RSI值在坐标图上连成的曲线，即为RSI线。

以日为计算周期为例，计算RSI值一般是以5日、10日、14日为一周期。另外也有以6日、12日、24日为计算周期。一般而言，若采用的周期的日数短，RSI指标反应可能比较敏感；日数较长，可能反应迟钝。目前，沪深股市中RSI所选用的基准周期为6日和12日。

和其他指标的计算一样，由于选用的计算周期的不同，RSI 指标也包括日RSI指标、周RSI指标、月RSI指标年RSI指标以及分钟RSI指标等各种类型。经常被用于股市研判的是日RSI指标和周RSI指标。虽然它们的计算时的取值有所不同，但基本的计算方法一样。另外，随着股市软件分析技术的发展，投资者只需掌握RSI形成的基本原理和计算方法，无须去计算指标的数值，更为重要的是利用RSI指标去分析、研判股票行情。

#### RSI的一般研判标准

RSI的研判主要是围绕RSI的取值、长期RSI和短期RSI的交叉状况及RSI的曲线形状等展开的。一般分析方法主要包括RSI取值的范围大小、RSI数值的超卖超买情况、长短期RSI线的位置及交叉等方面。

一、 RSI取值的大小

RSI的变动范围在0——100之间，强弱指标值一般分布在20——80。

RSI值 市场特征 投资操作

80——100 极强 卖出

50——80 强 买入

20——50 弱 观望

0——20 极弱 买入

这里的“极强”、“强”、“弱”、“极弱”只是一个相对的分析概念，是一个相对的区域。有的投资者也可把它们取值为30、70或15、85。另外，对于所取的RSI的参数的不同以及不同的股票，RSI的取值大小的研判也会不同，在下面部分再详加介绍。

二、 RSI数值的超买超卖

一般而言，RSI的数值在80以上和20以下为超买超卖区的分界线。

1、当RSI值超过80时，则表示整个市场力度过强，多方力量远大于空方力量，双方力量对比悬殊，多方大胜，市场处于超买状态，后续行情有可能出现回调或转势，此时，投资者可卖出股票。

2、当RSI值低于20时，则表示市场上卖盘多于买盘，空方力量强于多方力量，空方大举进攻后，市场下跌的幅度过大，已处于超卖状态，股价可能出现反弹或转势，投资者可适量建仓、买入股票。

3、当RSI值处于50左右时，说明市场处于整理状态，投资者可观望。

4、对于超买超卖区的界定，投资者应根据市场的具体情况而定。一般市道中，RSI数值在80以上就可以称为超买区，20以下就可以称为超卖区。但有时在特殊的涨跌行情中，RSI的超卖超买区的划分要视具体情况而定。比如，在牛市中或对于牛股，超买区可定为90以上，而在熊市中或对于熊股，超卖区可定为10以下（对于这点是相对于参数设置小的RSI而言的，如果参数设置大，则RSI很难到达90以上和10以下）。

三、长短期RSI线的交叉情况

短期RSI是指参数相对小的RSI，长期RSI是指参数相对较长的RSI。比如，6日RSI和12日RSI中，6日RSI即为短期RSI，12日RSI即为长期RSI。长短期RSI线的交叉情况可以作为我们研判行情的方法。

1、当短期RSI>长期RSI时，市场则属于多头市场；

2、当短期RSI<长期RSI时，市场则属于空头市场；

3、当短期RSI线在低位向上突破长期RSI线时，一般为RIS指标的“黄金交叉”，为买入信号；

4、当短期RSI线在高位向下突破长期RSI线时，一般为RSI指标的“死亡交叉”，为卖出信号。



 ### 中间意愿指标——CR

CR指标又叫中间意愿指标，它和AR、BR指标又很多相似之处，但更有自己独特的研判功能，是分析股市多空双方力量对比、把握买卖股票时机的一种中长期技术分析工具。


#### CR指标的原理

CR指标同AR、BR指标有很多相似的地方，如计算公式和研判法则等，但它与AR、BR指标最大不同的地方在于理论的出发点有不同之处。CR指标的理论出发点是：中间价是股市最有代表性的价格。

为避免AR、 BR指标的不足，在选择计算的均衡价位时，CR指标采用的是上一计算周期的中间价。理论上，比中间价高的价位其能量为“强”，比中间价低的价位其能量为“ 弱”。CR指标以上一个计算周期（如N日）的中间价比较当前周期（如日）的最高价、最低价，计算出一段时期内股价的“强弱”，从而在分析一些股价的异常波动行情时，有其独到的功能。

另外，CR指标不但能够测量人气的热度、价格动量的潜能，而且能够显示出股价的压力带和支撑带，为分析预测股价未来的变化趋势，判断买卖股票的时机提供重要的参考。

#### CR指标的计算方法

由于选用的计算周期不同，CR指标也包括日CR指标、周CR指标、月CR指标、年CR指标以及分钟CR指标等很多种类型。经常被用于股市研判的是日CR指标和周CR指标。虽然它们计算时取值有所不同，但基本的计算方法一样。

以日CR指标为例，其计算公式为：

CR（N日）=P1÷P2×100

式中，P1=∑（H－YM），表示N日以来多方力量的总和

P2=∑（YM－L），表示N日以来空方力量的总和

H表示今日的最高价，L表示今日的最低价

YM表示昨日（上一个交易日）的中间价

CR计算公式中的中间价其实也是一个指标，它是通过对昨日（YM）交易的最高价、最低价、开盘家和收盘价进行加权平均而得到的，其每个价格的权重可以人为地选定。目前比较常用地中间价计算方法有四种：

1、M=（2C+H+L）÷4

2、M=（C+H+L+O）÷4

3、M=（C+H+L）÷3

4、M=（H+L）÷2

式中，C为收盘价，H为最高价，L为最低价，O为开盘价

从四种中间价的计算方法来看，对四种价格的重视程度是不一样的，三种都是选用了收盘价，可见，收盘价在技术分析中的重要性。

和其他技术指标一样，在实战中，投资者不需要进行CR指标的计算，主要是了解CR的计算方法，以便更加深入地掌握CR指标的实质，为运用指标打下基础。

#### CR指标的一般研判标准

CR指标的一般研判标准主要集中在CR数值的取值范围、CR指标曲线的形态以及CR指标曲线与股价曲线的配合等方面来考察。

一、CR指标的取值

1、从CR的计算公式我们可以看出，CR指标很容易出现负值，但按通行的办法，在CR指标研判中，一旦CR数值出现负值，一律当成0对待。

2、和AR、BR指标一样，CR值为100时也表示中间的意愿买卖呈平衡状态。

3、当CR数值在75——125之间（有的设定为80——150）波动时，表明股价属于盘整行情，投资者应以观望为主。

4、在牛市行情中（或对于牛股），当CR数值大于300时，表明股价已经进入高价区，可能随时回挡，应择机抛出。

5、对于反弹行情而言，当CR数值大于200时，表明股价反弹意愿已经到位，可能随时再次下跌，应及时离场。

6、在盘整行情中，当CR数值在40以下时，表明行情调整即将结束，股价可能随时再次向上，投资者可及时买进。

7、在熊市行情末期，当CR数值在30以下时，表明股价已经严重超跌，可能随时会反弹向上。投资者可逢低吸纳。

8、CR指标对于高数值的研判的准确性要高于CR对低数值的研判。即提示股价进入高价位区的能力比提示低价位区强。

二、CR指标曲线的形态

CR指标的形态的研判主要是针对CR曲线在顶部和低部出现的不同形态而言的。

1、当CR曲线在高位形成M头或三重顶等顶部反转形态时，可能预示着行情由强势转为弱势，股价即将大跌（特别是对于前期涨幅过大的股票），如果股价的K线也出现同样形态则更可确认，其跌幅可以用M头或三重顶形态理论来研判。

2、当CR曲线在低位出现W底或三重底等底部反转形态时，可能预示着行情由弱势转为强势，股价即将反弹向上，如果股价K线也出现同样形态则更可确认，其涨幅可以用W底或三重底等形态来判断。

3、相对而言，CR指标的高位M头或三重顶的判断的准确性要比其底部的W底或三重底要高。

三、CR曲线与股价曲线配合使用

在一定程度上，CR指标具有领先股价走势的示警作用，尤其是在股价见顶或筑底方面，能能比股价曲线领先出现征兆。若股价曲线与CR指标曲线之间出现背离现象，则可能预示着股价走势即将反转。CR指标曲线与股价曲线的配合使用主要从以下几方面进行的。

1、当CR指标曲线节节向上攀升，而股价曲线也同步上升，则意味着股价走势是处于强势上涨的阶段，股价走势将维持向上攀升的态势，投资者可坚决持股待涨。

2、当CR指标曲线继续下跌，而股价曲线也同步下跌，则意味着股价走势是处于弱势下跌的阶段，弱势格局难以改变，此时，投资者应以持币观望为主。

3、当CR指标曲线开始从高位掉头向下回落，而股价曲线却还在缓慢向上扬升，则意味着股价走势可能出现“顶背离”现象，特别是股价刚刚经历过了一段比较大涨幅的上升行情以后。当CR指标曲线在高位出现“顶背离现象”后，投资者应及时获利了结。

4、当CR指标曲线从底部开始向上攀升，而股价曲线却继续下跌，则意味着股价走势可能出现“底背离”现象，特别是股价前期经过了一轮时间比较长、跌幅比较大的下跌行情以后。当CR指标曲线在底部出现“底背离”现象以后，投资者可以少量分批建仓。

5、CR指标对“顶背离”研判的准确性要远远高于对“底背离”的研判。


### 停损指标——SAR

SAR指标又叫抛物线指标或停损转向操作点指标，其全称叫“Stop and Reveres，缩写SAR”，是由美国技术分析大师威尔斯·威尔德（Wells Wilder）所创造的，是一种简单易学、比较准确的中短期技术分析工具。


#### SAR指标的原理

我们从SAR 指标英文全称知道它有两层含义。一是“stop”，即停损、止损之意，这就要求投资者在买卖某个股票之前，先要设定一个止损价位，以减少投资风险。而这个止损价位也不是一直不变的，它是随着股价的波动止损位也要不断的随之调整。如何既可以有效地控制住潜在的风险，又不会错失赚取更大收益的机会，是每个投资者所追求的目标。但是股市情况变幻莫测，而且不同的股票不同时期的走势又各不相同，如果止损位设的过高，就可能出现股票在其调整回落时卖出，而卖出的股票却从此展开一轮新的升势，错失了赚取更大利润的机会，反之，止损位定的过低，就根本起不到控制风险的作用。因此，如何准确地设定止损位是各种技术分析理论和指标所阐述的目的，而SAR指标在这方面有其独到的功能。

SAR 指标的英文全称的第二层含义是“Reverse”，即反转、反向操作之意，这要求投资者在决定投资股票前先设定个止损位，当价格达到止损价位时，投资者不仅要对前期买入的股票进行平仓，而且在平仓的同时可以进行反向做空操作，以谋求收益的最大化。这种方法在有做空机制的证券市场可以操作，而目前我国国内市场还不允许做空，因此投资者主要采用两种方法，一是在股价向下跌破止损价位时及时抛出股票后持币观望，二是当股价向上突破SAR指标显示的股价压力时，及时买入股票或持股待涨。

#### SAR指标的计算方法

和MACD、 DMI等指标相同的是，SAR指标的计算公式相当烦琐。SAR的计算工作主要是针对每个周期不断变化的SAR的计算，也就是停损价位的计算。在计算SAR 之前，先要选定一段周期，比如n日或n周等，n天或周的参数一般为4日或4周。接下来判断这个周期的股价是在上涨还是下跌，然后再按逐步推理方法计算 SAR值。

计算日SAR为例，每日SAR的计算公式如下：

SAR（n）=SAR（n－1）+AF<EP(n－1)—SAR（n－1）>

其中，SAR（n）为第n日的SAR值，SAR（n－1）为第（n－1）日的值

AF为加速因子（或叫加速系数），EP为极点价（最高价或最低价）

在计算SAR值时，要注意以下几项原则：

1、 一次计算SAR值时须由近期的明显高低点起的第n天开始。

2、如果是看涨的行情，则SAR（0）为近期底部最低价；如果是看跌行情，则SAR（0）为近期顶部的最高价。

3、加速因子AF有向上加速因子和向下加速因子的区分。若是看涨行情，则为向上加速因子；若是看跌行情，则为向下加速因子。

4、加速因子AF的初始值一直是以0.02为基数。如果是在看涨行情中买入股票后，某天的最高价比前一天的最高价还要高，则加速因子AF递增0.02，并入计算。但加速因子AF最高不超过0.2。反之，看跌行情中也以此类推。

5、如果在看涨行情中，计算出的某日的SAR值比当日或前一日的最低价高，则应以当日或前一日的最低价为该日的SAR值。如果在看跌行情中，计算出的某日的 SAR值比当日或前一日的最高价低，则应以当日或前一日的最高价为某日的SAR值。总之，SAR值不得定于当日或前一日的行情价格变动幅度之内。

6、任何一次行情的转变，加速因子AF都必须重新由0.02起算。

7、SAR指标周期的计算基准周期的参数为2，如2日、2周、2月等，其计算周期的参数变动范围为2—8。

8、SAR指标的计算方法和过程比较烦琐，对于投资者来说只要掌握其演算过程和原理，在实际操作中并不需要投资者自己计算SAR值，更重要的是投资者要灵活掌握和运用SAR指标的研判方法和功能。

#### SAR指标的一般研判标准

由于SAR指标简单易懂、操作方便、稳重可靠等优势，因此，SAR指标又称为“傻瓜”指标，被广大投资者特别是中小散户普遍运用。

一、SAR指标的一般研判标准

SAR指标的一般研判标准包括以下四方面：

1、当股票股价从SAR曲线下方开始向上突破SAR曲线时，为买入信号，预示着股价一轮上升行情可能展开，投资者应迅速及时地买进股票。

2、当股票股价向上突破SAR曲线后继续向上运动而SAR曲线也同时向上运动时，表明股价的上涨趋势已经形成，SAR曲线对股价构成强劲的支撑，投资者应坚决持股待涨或逢低加码买进股票。

3、当股票股价从SAR曲线上方开始向下突破SAR曲线时，为卖出信号，预示着股价一轮下跌行情可能展开，投资者应迅速及时地卖出股票。

4、当股票股价向下突破SAR曲线后继续向下运动而SAR曲线也同时向下运动，表明股价的下跌趋势已经形成，SAR曲线对股价构成巨大的压力，投资者应坚决持币观望或逢高减磅。

二、SAR指标的作用

与其他技术指标相比，SAR指标对于一般投资者对行情研判提供了相当大的帮助作用，具体表现在以下三方面：

1、持币观望

当一个股票的股价被SAR指标压制在其下方并一直向下运动时，投资者可一路持币观望，直到股价向上突破SAR指标的压力并发出明确的买入信号时，才可考虑是否买入股票。

2、持股待涨

当一个股票的股价在SAR指标上方并依托SAR指标一直向上运动时，投资者可一路持股待涨，直到股价向下突破SAR指标的支撑并发出明确的卖出信号时，才去考虑是否卖出股票。

3、明确止损

SAR 指标具有极为明确的止损功能，其止损又分为买入止损和卖出止损。卖出止损是指当SAR发出明确的买入信号时，不管投资者以前是在什么价位卖出的股票，是否亏损，投资者都应及时买入股票，持股待涨。买入止损是指当SAR指标发出明确的卖出信号时，不管投资者以前是在什么价位买入股票，是否赢利，投资者都应及时卖出股票，持币观望。

三、SAR指标的优点

SAR指标具有以下优点：

1、操作简单，买卖点明确，出现买卖信号即可进行操作，特别适合于入市时间不长、投资经验不丰富、缺乏买卖技巧的中小投资者使用。

2、适合于连续拉升的“牛股”，不会轻易被主力震仓和洗盘。

3、适合于连续阴跌的“熊股”，不会被下跌途中的反弹诱多所蒙骗。

4、适合于中短线的波段操作。

5、长期使用SAR指标虽不能买进最低价，也不能卖出最高价，但可以避免长期套牢的危险，同时又能避免错失牛股行情。



## 4.4. 特征重要性分析和降维

分析股价数据特征，主要对开盘价、收盘价、最高价、最低价、涨跌幅、成交额、换手率、量比、市盈率、市净率、市销率、流通股本、总股本、小、中、大、特大单买入卖出额等特征进行分析，并且对以上特征应用了指数移动平均、差分自相关等数据处理手段。

* 股价、成交量特征
<center><img src='project\feature_engineering\30_price_amount.png' width=1060></img></center>


* MACD 异步移动均线
<center><img src='project\feature_engineering\31_MACD.png' width=1060></img></center>


* 布林线和随机指标KDJ
<center><img src='project\feature_engineering\32_boll_kdj.png' width=1060></img></center>


* 开盘价和相关强弱指数RSI
<center><img src='project\feature_engineering\33_open_rsi.png' width=1060></img></center>


* 威廉指标WR和中间意愿指标CR
<center><img src='project\feature_engineering\34_cr_ma.png' width=1060></img></center>


* 短线超买超卖指标CCI、成交量变异率VR和波动幅度TR
<center><img src='project\feature_engineering\35_cci_tr_vr.png' width=1060></img></center>


* 动向指标DMI
<center><img src='project\feature_engineering\36_close_DMI.png' width=1060></img></center>


* 傅里叶变换和逆变换
<center><img src='project\feature_engineering\40_Fourier_transforms.png' width=1060></img></center>

* 股价频谱分析

<center><img src='project\feature_engineering\41_Fourier_components.png' width=1060></img></center>


* 收盘价逐日相关性 price correlation
<center><img src='project\feature_engineering\50_Close_price_correlations.png' width=1060></img></center>


* 特征重要性分析 xgboost回归
<center><img src='project\feature_engineering\61_Feature_importance.png' width=1060></img></center>

* 特征重要性误差分析
<center><img src='project\feature_engineering\60_Training_Vs_Validation_Error.png' width=1060></img></center>


我们可以看到，在去除强相关性的特征后，验证集的误差随着训练次数的迭代有所增加，表明模型出现了过拟合。

由于在股价数据中，包含有大量与股价特征强相关的数据，比如开盘价、股价动量（即为前一日的收盘价），股价七日均值等，在使用xgboost进行回归时，这些特征会因强相关特性而独占重要性指标，比如股价动量重要性可达到0.8以上，这样会削弱其他指标的重要性度量。

所以在实际操作中，为了将强相关因素排除，更多的利用其他指标构建股价的特征关系，我们删除了部分特征，并得到了以上特征重要性直方图。以上最重要的特征其重要性也在0.1左右，我们尽可能的实现特征与股价强相关的剥离，并试图发现股价与其他特征的关联。

* 降维

降维使用的是PCA主成分分析，并且保留75%的特征进行降维。

# 5. 训练模型

## Keras框架
Keras 是一个用 Python 编写的高级神经网络 API，它能够以 TensorFlow, CNTK, 或者 Theano 作为后端运行。Keras 的开发重点是支持快速的实验。能够以最小的时延把你的想法转换为实验结果，是做好研究的关键。

由于本项目基于快速成型的模型搭建原则，所以应用Keras这种高层API更加方便。

>允许简单而快速的原型设计（由于用户友好，高度模块化，可扩展性）。
同时支持卷积神经网络和循环神经网络，以及两者的组合。
在 CPU 和 GPU 上无缝运行。

**Keras的特征** 

>用户友好。 Keras 是为人类而不是为机器设计的 API。它把用户体验放在首要和中心位置。Keras 遵循减少认知困难的最佳实践：它提供一致且简单的 API，将常见用例所需的用户操作数量降至最低，并且在用户错误时提供清晰和可操作的反馈。

>模块化。 模型被理解为由独立的、完全可配置的模块构成的序列或图。这些模块可以以尽可能少的限制组装在一起。特别是神经网络层、损失函数、优化器、初始化方法、激活函数、正则化方法，它们都是可以结合起来构建新模型的模块。

>易扩展性。 新的模块是很容易添加的（作为新的类和函数），现有的模块已经提供了充足的示例。由于能够轻松地创建可以提高表现力的新模块，Keras 更加适合高级研究。

>基于 Python 实现。 Keras 没有特定格式的单独配置文件。模型定义在 Python 代码中，这些代码紧凑，易于调试，并且易于扩展。



## 使用VAE生成模型获取股价特征的分布特性

TODO


## 使用GAN网络生成股价预测数据

TODO


# 6. 评估和调参

## keras强化学习框架

# 7. 可视化

TODO

# 8. 参考资料

感谢支持，赚个积分。

https://tushare.pro/register?reg=266868 